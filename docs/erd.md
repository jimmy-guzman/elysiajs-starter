# Database

This project uses **Drizzle ORM** with **Neon Postgres** for a fully type-safe, serverless-ready database layer.

We follow a modular, relational structure:

- **Authentication layer** powered by **[Better Auth](https://www.better-auth.com/)**.
- **Project management layer** built on top with projects, tasks, and tags.

## Authentication Schema

The authentication tables (`user`, `session`, `account`, `verification`) are generated following the [Better Auth database schema](https://www.better-auth.com/docs/installation#create-database-tables).

This ensures full compatibility with Better Auth's authentication, session, and account management.

## Entity Relationship Diagram (ERD)

```mermaid
erDiagram
  user {
    string id
    string name
    string email
    boolean email_verified
    string image
    string created_at
    string updated_at
  }

  session {
    string id
    string expires_at
    string token
    string created_at
    string updated_at
    string ip_address
    string user_agent
    string user_id
  }

  account {
    string id
    string account_id
    string provider_id
    string user_id
    string access_token
    string refresh_token
    string id_token
    string access_token_expires_at
    string refresh_token_expires_at
    string scope
    string password
    string created_at
    string updated_at
  }

  verification {
    string id
    string identifier
    string value
    string expires_at
    string created_at
    string updated_at
  }

  tags {
    string id
    string name
    string created_at
  }

  projects {
    string id
    string name
    string description
    string owner_id
    string created_at
    string updated_at
  }

  tasks {
    string id
    string project_id
    string parent_id
    string owner_id
    string title
    string status
    int priority
    string due_at
    boolean completed
    string created_at
    string updated_at
  }

  project_tags {
    string project_id
    string tag_id
  }

  task_tags {
    string task_id
    string tag_id
  }

  %% Relationships
  user ||--o{ session : has
  user ||--o{ account : has
  user ||--o{ projects : owns
  user ||--o{ tasks : owns
  projects ||--o{ tasks : has
  projects ||--o{ project_tags : tagged
  tasks ||--o{ task_tags : tagged
  tags ||--o{ project_tags : used_in
  tags ||--o{ task_tags : used_in
  tasks ||--o{ tasks : parent_of
```

---

## Technology Stack

- üóÑ **Drizzle ORM**: A lightweight, type-safe ORM for SQL databases.
- üèõ **Neon Postgres**: Serverless Postgres with branching and autoscaling.
- üîê **Better Auth**: Drop-in authentication provider with auto-generated database tables.
- üõ° **Full Type Safety**: All tables, queries, and relationships are validated at compile-time.

---

## Table Summary

| Table          | Purpose                                                                 |
| :------------- | :---------------------------------------------------------------------- |
| `user`         | Better Auth user model. Stores account info.                            |
| `session`      | Better Auth session model. Tracks logins and expirations.               |
| `account`      | Better Auth linked accounts (e.g., OAuth, email-password).              |
| `verification` | Better Auth verifications for password reset, email confirmations, etc. |
| `projects`     | User-created projects.                                                  |
| `tasks`        | Tasks associated with projects, supporting hierarchy.                   |
| `tags`         | Tags that can be assigned to projects or tasks.                         |
| `project_tags` | Linking table for project‚Äìtag relationships.                            |
| `task_tags`    | Linking table for task‚Äìtag relationships.                               |

---

## Notes

- **Auth Tables**: Auto-generated by Better Auth; updated manually only for migration needs.
- **Cascade Deletes**: Enabled for tasks, project-tags, and task-tags.
- **Composite Keys**: `project_tags` and `task_tags` use composite primary keys.
- **UUIDs**: All user-created content (`projects`, `tasks`, `tags`) uses UUID primary keys for global uniqueness.
